<%= stylesheet_link_tag 'custom', media: 'all', 'data-turbolinks-track': 'reload' %>

<div class="py-6 sm:py-8 lg:py-12">
  <div class="mx-auto max-w-screen-2xl px-4 md:px-8">
    <div class="mb-10 md:mb-16" style="margin-top: 20px;">
      <h2 class="mb-4 text-center text-2xl font-bold text-gray-800 md:mb-6 lg:text-3xl"><%= t('.title') %></h2>
    </div>

    <div class="flex justify-center">
      <%= search_form_for @q, url: model_courses_path, method: :get, id: 'search-form', class: "flex items-center" do |f| %>
        <%= f.select :prefecture_eq, ModelCourse.prefectures, { include_blank: "éƒ½é“åºœçœŒã‚’é¸æŠ" }, { class: "px-4 py-2 border rounded-md" } %>
        <%= f.select :vehicle_eq, options_for_select(ModelCourse.vehicles_i18n.map { |key, value| [value, key] }, params[:q]&.dig(:vehicle_eq)), { include_blank: "ç§»å‹•æ‰‹æ®µã‚’é¸æŠ" }, { class: "px-4 py-2 border rounded-md" } %>
        <%= f.submit "æ¤œç´¢", class: "btn btn-accent ml-2" %>
      <% end %>
    </div>
  
    <div class="flex justify-center">  
      <% if @no_results %>
        <p class="text-gray-500">æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“</p>
      <% end %>
    </div>

    <div class="mt-8"></div>
    <div class="grid gap-4 sm:grid-cols-2 md:gap-6 lg:grid-cols-3 xl:grid-cols-4 xl:gap-8">
      <%= render partial: 'model_courses/model_course' %>
    </div>

    <div class="mt-8"></div>
    <div class="flex justify-center mt-4">
      <%= paginate @model_courses %>
    </div>
  </div>
</div>

<% @model_courses.each do |model_course| %>
  <div class="modal js-modal">
    <div class="modal-container">
      <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ -->
      <div class="modal-close js-modal-close">Ã—</div>
      <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«å†…éƒ¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
      <div class="modal-content">
        <p>ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã®æŠ•ç¨¿ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ğŸ‰âœ¨</p>
        <p>æŠ•ç¨¿ã—ãŸãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã‚’Twitterã§ã‚‚å…±æœ‰ã—ã‚ˆã†ï¼</p>
        <% set_meta_tags og: { image: image_url(@tweet_image_url) }, twitter: { image: image_url(@tweet_image_url) } %>
        <%= link_to "https://twitter.com/share?url=#{ model_course_url(@latest_model_course) }&text=#{@latest_model_course.user.name}ã•ã‚“ãŒã€Œ#{@latest_model_course.name}ã€ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸï¼%0A&hashtags=TravelModelCourse", class: 'twitter-share-button', 'data-show-count' => 'false', target: '_blank' do %>
           Tweet
        <% end %>
        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div>
    </div>
  </div>
<% end %>

<script>
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãé–¢æ•°
  function modalOpen() {
    const modal = document.querySelector('.js-modal');
    modal.classList.add('is-active');
  }

  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•°
  function modalClose() {
    const modal = document.querySelector('.js-modal');
    modal.classList.remove('is-active');
  }

  // ãƒãƒ„å°ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚
const buttonClose = document.querySelector('.js-modal-close');
buttonClose.addEventListener('click', function () {
  const modal = document.querySelector('.js-modal');
  modal.style.display = 'none';
  body.classList.remove('open');
});


// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä»¥å¤–ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚
const modal = document.querySelector('.js-modal');
modal.addEventListener('click', function (event) {
  if (event.target === modal) {
    modal.style.display = 'none';
    body.classList.remove('open');
  }
});


  // URLã‹ã‚‰ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å–å¾—ã™ã‚‹é–¢æ•°
  function getQueryParams() {
    const queryParams = new URLSearchParams(window.location.search);
    return queryParams;
  }

  // ä¸€è¦§ç”»é¢ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸéš›ã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  window.addEventListener('load', function () {
    // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰ show_modal ã®å€¤ã‚’å–å¾—
    const queryParams = getQueryParams();
    const showModal = queryParams.get('show_modal');

    // show_modal ãŒ true ã®å ´åˆã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    if (showModal === 'true') {
      modalOpen();
    }
  });

  // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  window.addEventListener('load', function () {
    modalOpen();
  });
</script>

<style>
.modal-open {
  position: fixed;
  top: 50%;
  left: 50%;
  font-size: 16px;
  font-weight: bold;
  width: 300px;
  height: 60px;
  color: #fff;
  background: #000;
  border: none;
  cursor: pointer;
  transform: translate(-50%, -50%); /* ä¸­å¤®ã«é…ç½® */
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã¨èƒŒæ™¯ã®æŒ‡å®š */
.modal{
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  text-align: center;
  background: rgba(0,0,0,50%);
  padding: 40px 20px;
  overflow: auto;
  opacity: 0;
  visibility: hidden;
  transition: .3s;
  box-sizing: border-box;
}


/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ“¬ä¼¼è¦ç´ ã®æŒ‡å®š */
.modal:before{
  content: "";
  display: inline-block;
  vertical-align: middle;
  height: 100%;
  margin-left: -0.2em;
}

/* ã‚¯ãƒ©ã‚¹ãŒè¿½åŠ ã•ã‚ŒãŸæ™‚ã®æŒ‡å®š */
.modal.is-active{
  opacity: 1;
  visibility: visible;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«å†…å´ã®æŒ‡å®š */
.modal-container{
  position: relative;
  display: inline-block;
  vertical-align: middle;
  max-width: 600px;
  width: 90%;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®æŒ‡å®š */
.modal-close{
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  top: -20px;
  right: -20px;
  width: 40px;
  height: 40px;
  color: #fff;
  background: #000;
  border-radius: 50%;
  cursor: pointer;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ†ã®æŒ‡å®š */
.modal-content{
  background: #fff;
  text-align: left;
  line-height: 1.8;
  padding: 20px;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ†ã®ãƒ†ã‚­ã‚¹ãƒˆã®æŒ‡å®š */
.modal-content p{
  margin: 1em 0;
}
</style>
