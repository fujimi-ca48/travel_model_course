<%= stylesheet_link_tag 'custom', media: 'all', 'data-turbolinks-track': 'reload' %>
<%= stylesheet_link_tag 'modal', media: 'all', 'data-turbolinks-track': 'reload' %>

<div class="py-6 sm:py-8 lg:py-12">
  <div class="mx-auto max-w-screen-2xl px-4 md:px-8">
    <div class="mb-10 md:mb-16" style="margin-top: 20px;">
      <h2 class="mb-4 text-center text-2xl font-bold text-gray-800 md:mb-6 lg:text-3xl"><%= t('.title') %></h2>
    </div>

    <div class="flex justify-center">
      <%= search_form_for @q, url: model_courses_path, method: :get, id: 'search-form', class: "flex items-center" do |f| %>
        <%= f.select :prefecture_eq, ModelCourse.prefectures, { include_blank: "éƒ½é“åºœçœŒã‚’é¸æŠ" }, { class: "px-4 py-2 border rounded-md" } %>
        <%= f.select :vehicle_eq, options_for_select(ModelCourse.vehicles_i18n.map { |key, value| [value, key] }, params[:q]&.dig(:vehicle_eq)), { include_blank: "ç§»å‹•æ‰‹æ®µã‚’é¸æŠ" }, { class: "px-4 py-2 border rounded-md" } %>
        <%= f.submit "æ¤œç´¢", class: "btn btn-accent ml-2" %>
      <% end %>
    </div>
  
    <div class="flex justify-center">  
      <% if @no_results %>
        <p class="text-gray-500">æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“</p>
      <% end %>
    </div>

    <div class="mt-8"></div>
    <div class="grid gap-4 sm:grid-cols-2 md:gap-6 lg:grid-cols-3 xl:grid-cols-4 xl:gap-8">
      <%= render partial: 'model_courses/model_course' %>
    </div>

    <div class="mt-8"></div>
    <div class="flex justify-center mt-4">
      <%= paginate @model_courses %>
    </div>
  </div>
</div>

<div class="modal-container">
  <div class="modal-body">
    <div class="modal-close">Ã—</div>
    <div class="modal-content">
    <p class="text-gray-800">ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã‚’æŠ•ç¨¿ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ğŸ‰âœ¨</p>
    <p class="text-gray-800">æŠ•ç¨¿ã—ãŸãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã‚’Twitterã§ã‚‚å…±æœ‰ã—ã‚ˆã†ï¼</p>
    <% if @latest_model_course.spot_item_data.present? %>
      <% spot_item_data = JSON.parse(@latest_model_course.spot_item_data) %>
        <% first_spot = spot_item_data.first %>
        <% recommended_spot_id = first_spot["recommended_spot_id"] %>
        <% recommended_spot = RecommendedSpot.find_by(id: recommended_spot_id) %>
        <% recommended_spot_image_url = recommended_spot&.img&.url %>
    <% end %>
    <% set_meta_tags  og: { image: image_url(recommended_spot_image_url ) }, twitter: { image: image_url(recommended_spot_image_url ) } %>
    <%= link_to "https://twitter.com/share?url=#{ model_course_url(@latest_model_course) }&text=#{@latest_model_course.user.name}ã•ã‚“ãŒã€Œ#{@latest_model_course.name}ã€ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸï¼%0A&hashtags=TravelModelCourse", class: 'twitter-share-button', 'data-show-count' => 'false', target: '_blank' do %>
       Tweet
    <% end %>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
  </div>
</div>

<script>
$(function(){
  // å¤‰æ•°ã«è¦ç´ ã‚’å…¥ã‚Œã‚‹
  var open = $('.modal-open'),
    close = $('.modal-close'),
    container = $('.modal-container');

  //é–‹ããƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹
  open.on('click',function(){ 
    container.addClass('active');
    return false;
  });

  //é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  close.on('click',function(){  
    container.removeClass('active');
  });

  //ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  $(document).on('click',function(e) {
    if(!$(e.target).closest('.modal-body').length) {
      container.removeClass('active');
    }
  });
});

$(function(){
  // æ–°è¦ä½œæˆç”»é¢ã‹ã‚‰é·ç§»ã—ãŸå ´åˆã®ã¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function openModal() {
    $('.modal-container').addClass('active');
  }


// ãƒšãƒ¼ã‚¸ã®URLã« show_modal ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒã‚ã‚‹å ´åˆã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
const queryParams = new URLSearchParams(window.location.search);
if (queryParams.get('show_modal') === 'true') {
  openModal();
}
});
</script>

